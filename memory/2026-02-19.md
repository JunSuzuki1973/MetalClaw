# 2026年2月19日 - Agent Zero連携成功！🎉

## 🎉 今日の成果

### 1. Agent Zero HTTP APIの分析
- **APIエンドポイント:**
  - `POST http://localhost:5000/message` - メッセージ送信
  - `GET http://localhost:5000/csrf_token` - CSRFトークン取得
  - `GET http://localhost:5000/health` - ヘルスチェック

- **認証方式:**
  - APIキー: `X-API-KEY: <runtime_id_hash>`
  - CSRFトークン: `X-CSRF-Token: <token>` + Cookie

- **APIキー計算方法:**
  ```python
  hash_bytes = hashlib.sha256(f"{runtime_id}::username:password".encode()).digest()
  b64_token = base64.urlsafe_b64encode(hash_bytes).decode().replace("=", "")
  api_key = b64_token[:16]
  ```

### 2. Agent Zeroネットワーク問題の解決
- **問題:** Agent Zeroが`localhost`のみでリッスンしていた
- **解決:** `/root/.openclaw/workspace/agent-zero/usr/.env`に追加
  ```
  WEB_UI_HOST=0.0.0.0
  ```
- **結果:** ホストから`http://localhost:5000`でアクセス可能に

### 3. MetalClaw + Agent Zero連携ツールの実装
- **ファイル:** `nanobot/agent/tools/agent_zero_tool.py`
- **機能:**
  - CSRFトークンの自動取得
  - APIキー認証
  - メッセージ送信とレスポンス受信
  - コンテキスト管理（会話継続可能）

- **APIキー:** `rkjGYeREjK+zDV9K`（runtime_id: `dc92d21faae8c49d`）

### 4. 成功！MetalClaw → Agent Zero → MetalClaw
- **テスト結果:**
  - MetalClawからAgent Zeroにメッセージ送信: ✅
  - Agent Zeroからのレスポンス受信: ✅
  - コンテキストID: `shhu1AOc`

- **Agent Zeroの応答:**
  ```
  **こんにちは、JUNさん！** 👋
  テストありがとうございます！正常にメッセージを受信できていますよ。✅
  ```

---

## 📝 技術的詳細

### Agent Zero API呼び出しフロー
1. `GET /csrf_token` - CSRFトークン取得（Cookieも保存）
2. `POST /message` - メッセージ送信
   - Headers:
     - `X-API-KEY: rkjGYeREjK+zDV9K`
     - `X-CSRF-Token: <token>`
     - `Origin: http://localhost:5000`
   - Cookies: `<token>_dc92d21faae8c49d`
   - Body: `{"text": "message", "context": "context_id"}`
3. レスポンス: `{"message": "response", "context": "context_id"}`

### ファイル構成
```
MetalClaw/
├── nanobot/agent/tools/
│   ├── agent_zero_tool.py    ← 新しいAgent Zero連携ツール
│   ├── base.py
│   ├── http_request.py
│   └── ...
├── nanobot/agent/
│   ├── loop.py                ← AgentZeroTool登録
│   └── ...
└── README.md                 ← 更新予定
```

---

## 🚀 次のステップ

1. **GitHubリポジトリ更新:**
   - README.mdでAgent Zero連携をアピール
   - JUNのレコメンドを記載
   - nanobotからMetalClawへの修正
   - Agent Zeroとの連携手順をインストラクションに追加
   - Fork元（HKUDS/nanobot）を記載

2. **機能拡張:**
   - `/zero` スラッシュコマンドでAgent Zeroモードに切り替え
   - OpenCodeツールも同様に実装
   - コンテキスト継続機能の改善

---

## 💡 レコメンドしている技術

- **Agent Zero:** https://github.com/agent0ai/agent-zero
  - 複雑なAIタスクを自動化
  - Web検索、コード実行、ファイル操作
  - マルチエージェント協調

- **nanobot:** https://github.com/HKUDS/nanobot
  - MetalClawのFork元
  - 軽量なAIエージェントフレームワーク
  - Telegramボットとの連携

---

_今日はMetalClawとAgent Zeroの連携に成功した！_ 😈
